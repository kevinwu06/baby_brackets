<!-- extend base layout -->
{% extends "base.html" %}
{% set active_page = "edit" %}
{% block content %}
{% include 'flash.html' %}
<style>
/*
 *  Flex Layout Specifics
*/
main{
  display:flex;
  flex-direction:row;
}
.round{
  display:flex;
  flex-direction:column;
  justify-content:center;
  width:200px;
  list-style:none;
  padding:0;
}
  .round .spacer{ flex-grow:1; }
  .round .spacer:first-child,
  .round .spacer:last-child{ flex-grow:.5; }

  .round .game-spacer{
    flex-grow:1;
  }

/*
 *  General Styles
*/
body{
  font-family:sans-serif;
  font-size:small;
  padding:10px;
  line-height:1.4em;
}

li.game{
  padding-left:20px;
}

  li.game.winner{
    font-weight:bold;
    color: #337ab7;
  }
  li.game span{
    float:right;
    margin-right:5px;
  }

  li.game-top{ border-bottom:1px solid #aaa; }

  li.game-spacer{
    border-right:1px solid #aaa;
    min-height:40px;
  }

  li.game-bottom{
    border-top:1px solid #aaa;
  }
</style>
{% if parent_flag %}
<div class="row">
  <div class="col-md-4">
    <div class="input-group copyGroup">
      <span class="input-group-addon">Share link</span>
      <input type="text" class="form-control" aria-describedby="basic-addon2" id="copyTarget" value="http://babybracket.com/pool/{{ bracket_hash }}">
      <span class="input-group-btn copyButton" id="basic-addon2"><button class="btn btn-default" type="button" data-container="body" data-toggle="popover" data-placement="right" data-content="Link copied to clipboard!"><span class="glyphicon glyphicon-copy" aria-hidden="true"></span></button></span>
    </div>
  </div>
</div>
{% endif %}
<div class="row">
  <div class="col-md-4">
    <h2><span class="label label-primary">{{ round1[0].bracket.name }}</span></h2>
  </div>
</div>
<main id="tournament">
	<ul class="round round-1">
		<li class="spacer">&nbsp;</li>
    {% for match in round1 %}
      <li class="game game-top {% if match.winner == match.name1|default('', true) %}winner{% endif %}" data-bracketid="{{match.bracket_id}}" data-matchid="{{match.match_id}}" data-nameid="{{match.name1_id}}" data-name="{{match.name1}}">{{ match.name1|default('', true) }} <span class="glyphicon glyphicon-heart" aria-hidden="true"></span></li>
  		<li class="game game-spacer">&nbsp;</li>

      <li class="game game-bottom {% if match.winner == match.name2|default('', true) %}winner{% endif %}" data-bracketid="{{match.bracket_id}}" data-matchid="{{match.match_id}}" data-nameid="{{match.name2_id}}" data-name="{{match.name2}}">{{ match.name2|default('', true) }} <span class="glyphicon glyphicon-heart" aria-hidden="true"></span></li>
  		<li class="spacer">&nbsp;</li>
    {% endfor %}
	</ul>
	<ul class="round round-2">
    <li class="spacer">&nbsp;</li>
    {% for match in round2 %}
    <li class="game game-top {% if match.winner == match.name1|default('', true) %}winner{% endif %}" data-bracketid="{{match.bracket_id}}" data-matchid="{{match.match_id}}" data-nameid="{{match.name1_id}}" data-name="{{match.name1}}">{{ match.name1|default('', true) }} <span class="glyphicon glyphicon-heart" aria-hidden="true"></span></li>
    <li class="game game-spacer">&nbsp;</li>

    <li class="game game-bottom {% if match.winner == match.name2|default('', true) %}winner{% endif %}" data-bracketid="{{match.bracket_id}}" data-matchid="{{match.match_id}}" data-nameid="{{match.name2_id}}" data-name="{{match.name2}}">{{ match.name2|default('', true) }} <span class="glyphicon glyphicon-heart" aria-hidden="true"></span></li>
    <li class="spacer">&nbsp;</li>
    {% endfor %}
	</ul>
	<ul class="round round-3">
    <li class="spacer">&nbsp;</li>
    {% for match in round3 %}
    <li class="game game-top {% if match.winner == match.name1|default('', true) %}winner{% endif %}" data-bracketid="{{match.bracket_id}}" data-matchid="{{match.match_id}}" data-nameid="{{match.name1_id}}" data-name="{{match.name1}}">{{ match.name1|default('', true) }} <span class="glyphicon glyphicon-heart" aria-hidden="true"></span></li>
    <li class="game game-spacer">&nbsp;</li>

    <li class="game game-bottom {% if match.winner == match.name2|default('', true) %}winner{% endif %}" data-bracketid="{{match.bracket_id}}" data-matchid="{{match.match_id}}" data-nameid="{{match.name2_id}}" data-name="{{match.name2}}">{{ match.name2|default('', true) }} <span class="glyphicon glyphicon-heart" aria-hidden="true"></span></li>
    <li class="spacer">&nbsp;</li>
    {% endfor %}
	</ul>
	<ul class="round round-4">
    <li class="spacer">&nbsp;</li>
    {% for match in round4 %}
    <li class="game game-top {% if match.winner == match.name1|default('', true) %}winner{% endif %}" data-bracketid="{{match.bracket_id}}" data-matchid="{{match.match_id}}" data-nameid="{{match.name1_id}}" data-name="{{match.name1}}">{{ match.name1|default('', true) }} <span class="glyphicon glyphicon-heart" aria-hidden="true"></span></li>
    <li class="game game-spacer">&nbsp;</li>

    <li class="game game-bottom {% if match.winner == match.name2|default('', true) %}winner{% endif %}" data-bracketid="{{match.bracket_id}}" data-matchid="{{match.match_id}}" data-nameid="{{match.name2_id}}" data-name="{{match.name2}}">{{ match.name2|default('', true) }} <span class="glyphicon glyphicon-heart" aria-hidden="true"></span></li>
    <li class="spacer">&nbsp;</li>
    {% endfor %}
	</ul>
</main>
<script>
function advanceName(name, nameid, matchid, bracketid) {
  // logic for 16 team tournament advancement
  // defines next match to insert winner, id of that match
  // and whether it is the top (1) or bottom (2) team
  if (matchid == 1) {
    nextgame = $('li.game-top[data-matchid=9]');
    nextid = 9;
    nextTopOrBottom = 1;
  } else if (matchid == 5) {
    nextgame = $('li.game-bottom[data-matchid=9]');
    nextid = 9;
    nextTopOrBottom = 2;
  } else if (matchid == 2) {
    nextgame = $('li.game-top[data-matchid=10]');
    nextid = 10;
    nextTopOrBottom = 1;
  } else if (matchid == 6) {
    nextgame = $('li.game-bottom[data-matchid=10]');
    nextid = 10;
    nextTopOrBottom = 2;
  } else if (matchid == 3) {
    nextgame = $('li.game-top[data-matchid=11]');
    nextid = 11;
    nextTopOrBottom = 1;
  } else if (matchid == 7) {
    nextgame = $('li.game-bottom[data-matchid=11]');
    nextid = 11;
    nextTopOrBottom = 2;
  } else if (matchid == 4) {
    nextgame = $('li.game-top[data-matchid=12]');
    nextid = 12;
    nextTopOrBottom = 1;
  } else if (matchid == 8) {
    nextgame = $('li.game-bottom[data-matchid=12]');
    nextid = 12;
    nextTopOrBottom = 2;
  } else if (matchid == 9) {
    nextgame = $('li.game-top[data-matchid=13]');
    nextid = 13;
    nextTopOrBottom = 1;
  } else if (matchid == 10) {
    nextgame = $('li.game-bottom[data-matchid=13]');
    nextid = 13;
    nextTopOrBottom = 2;
  } else if (matchid == 11) {
    nextgame = $('li.game-top[data-matchid=14]');
    nextid = 14;
    nextTopOrBottom = 1;
  } else if (matchid == 12) {
    nextgame = $('li.game-bottom[data-matchid=14]');
    nextid = 14;
    nextTopOrBottom = 2;
  } else if (matchid == 13) {
    nextgame = $('li.game-top[data-matchid=15]');
    nextid = 15;
    nextTopOrBottom = 1;
  } else if (matchid == 14) {
    nextgame = $('li.game-bottom[data-matchid=15]');
    nextid = 15;
    nextTopOrBottom = 2;
  }
  // insert winner into next match and update data attributes
  nextgame.html(name + ' <span class="glyphicon glyphicon-heart" aria-hidden="true"></span>')
    .data('name', name)
    .data('nameid', nameid);
  // AJAX post to api endpoint with data tp update database
  $.post('/api/edit', { bracket_id: bracketid, match_id: matchid, winner_id: nameid, next_id: nextid, next_Top_Or_Bottom: nextTopOrBottom });
}
$( document ).ready(function() {
  // click event listener for each name in bracket
  $('li.game.game-top, li.game.game-bottom').click(function() {
    var name = $(this).data('name');
    var nameid = $(this).data('nameid');
    var matchid = $(this).data('matchid');
    var bracketid = $(this).data('bracketid');
    advanceName(name, nameid, matchid, bracketid);
    // remove winner class from other name if present for formatting
    $('li.game[data-matchid='+matchid+']').removeClass('winner');
    // add winner class to clicked name to format bold and color
    $(this).addClass('winner')
  });
  // copy share link text to clipboard
  $('span.copyButton').click(function() {
    $('#copyTarget').focus().select()
    document.execCommand("copy");
  });
  $('.btn').popover();
});
</script>
{% endblock %}
